---
typora-root-url: ..
---

## 相关加密算法

### DES算法

+ 对称加密，即它需要使用同一个密钥来进行加密和解密
+ 非对称加密，它需要一对密钥：公钥和私钥，如果用公钥对数据进行加密，只有用对应的私钥才能解密。甲方生成一对[密钥](https://baike.baidu.com/item/密钥/101144)并将公钥公开，需要向甲方发送信息的其他角色，(乙方)使用该密钥(甲方的公钥)对机密信息进行加密后再发送给甲方；甲方再用自己私钥对加密后的信息进行解密。甲方想要回复乙方时正好相反，使用乙方的公钥对数据进行加密，同理，乙方使用自己的私钥来进行解密。另一方面，甲方可以使用自己的私钥对机密信息进行签名后再发送给乙方；乙方再用甲方的公钥对甲方发送回来的数据进行验签。
+ 它是一种对称加密算法
+ 它是一种分组加密，每次处理固定长度的数据段(分组)，默认分组大小为64位
+ 从本质上来说，DES的安全性依赖于虚假表象，从密码学的术语来讲就是依赖于“混乱和扩散”的原则。混乱的目的是为隐藏任何明文同密文、或者密钥之间的关系，而扩散的目的是使明文中的有效位和密钥一起组成尽可能多的密文。两者结合到一起就使得安全性变得相对较高。
+ DES算法具体通过对明文进行一系列的排列和替换操作来将其加密。过程的关键就是从给定的初始密钥中得到16个子密钥的函数。要加密一组明文，每个子密钥按照顺序（1-16）以一系列的位操作施加于数据上，每个子密钥一次，一共重复16次。每一次迭代称之为一轮。要对密文进行解密可以采用同样的步骤，只是子密钥是按照逆向的顺序（16-1）对密文进行处理。

### Diffie-Hellman密钥交换算法

#### 原理

> ```
> （1）Alice与Bob确定两个大素数n和g，这两个数不用保密
> （2）Alice选择另一个大随机数x，并计算A如下：A=gx mod n
> （3）Alice将A发给Bob
> （4）Bob选择另一个大随机数y，并计算B如下：B=gy mod n
> （5）Bob将B发给Alice
> （6）计算秘密密钥K1如下：K1=Bx mod n
> （7）计算秘密密钥K2如下：K2=Ay mod n
> K1=K2，因此Alice和Bob可以用其进行加解密 
> ```

### RSA加密算法

#### 原理

两个大素数相乘容易，而对得到的乘积求因子则很难

> ```
> (1)选择两个大素数P、Q
> (2)计算N=P*Q
> (3)选择一个公钥（加密密钥）E，使其不是(P-1)与(Q-1)的因子
> (4)选择私钥（解密密钥）D，满足如下条件：
>           (D*E) mod (P-1)(Q-1)=1
> (5)加密时，明文PT计算密文CT如下：
>           CT=PTE mod N
> (6)解密时，从密文CT计算明文PT如下：
>           PT=CTDmodN 这也是SSL中会用一种密钥交换算法。 
> ```

### 散列算法

主要用于验证数据的完整性，即保证时消息在发送之后和接收之前没有被篡改对于SSL中使用到的散列算法有MD5、SHA-1。



## 数字证书

在ssl中使用数字证书来证明自己的身份



## ssl协议定义

+ 安全套接字，是web浏览器和web服务器之间安全交换信息的协议，提供两个基本的安全服务：鉴别和保密
+ 保密，在握手协议中定义了会话密钥之后，所有消息都被加密
+ 鉴别，可选的客户端认证、强制的服务器端认证
+ 完整性，使用mac对传输的消息进行完整性检查

## ssl的位置

+ 它介于应用层和运输层之间，应用进程不再直接把数据传输给传输层，而是传输给ssl层，它对数据进行加密，并添加自己的ssl首部

## ssl工作原理

### 握手协议

+ 它是使用ssl连接通信的第一个子协议
+ 服务器和客户机相互验证，协商加密和MAC算法以及保密密钥，用来保护在SSL记录中发送的数据。
+ 它在应用进程开始数据传输之前使用
+ 每个握手协议包含以下3个字段、

1. Type：表示10种消息类型之一
2. Length：表示消息长度字节数
3. Content：与消息相关的参数

+ 握手协议的4个阶段

1.  建立安全能力

SSL握手的第一阶段启动逻辑连接，建立这个连接的安全能力。首先客户机向服务器发出client hello消息并等待服务器响应，随后服务器向客户机返回server hello消息，对client hello消息中的信息进行确认

Client hello消息包括Version，Random，Session id，Cipher suite，Compression method等信息。

![1579611380479](.\css\images\1579611380479.png)

ClientHello 客户发送CilentHello信息，包含如下内容：

　　（1）客户端可以支持的SSL最高版本号

　　（2）一个用于生成主秘密的32字节的随机数。（等会介绍主秘密是什么）

　　（3）一个确定会话的会话ID。

　　（4）一个客户端可以支持的密码套件列表。

密码套件格式：每个套件都以“SSL”开头，紧跟着的是密钥交换算法。用“With”这个词把密钥交换算法、加密算法、散列算法分开，例如：SSL_DHE_RSA_WITH_DES_CBC_SHA, 表示把DHE_RSA(带有RSA数字签名的暂时Diffie-HellMan)定义为密钥交换算法；把DES_CBC定义为加密算法；把SHA定义为散列算法。

​		（5）一个客户端可以支持的压缩算法列表。



ServerHello服务器用ServerHello信息应答客户，包括下列内容

　　（1）一个SSL版本号。取客户端支持的最高版本号和服务端支持的最高版本号中的较低者。

　　（2）一个用于生成主秘密的32字节的随机数。（客户端一个、服务端一个）

　　（3）会话ID

　　（4）从客户端的密码套件列表中选择的一个密码套件

　　（5）从客户端的压缩方法的列表中选择的压缩方法



这个阶段之后，客户端服务端知道了下列内容：

　　（1）SSL版本

　　（2）密钥交换、信息验证和加密算法

　　（3）压缩方法

　　（4）有关密钥生成的两个随机数。

### **服务器鉴别与密钥交换**

服务器启动SSL握手第2阶段，是本阶段所有消息的唯一发送方，客户机是所有消息的唯一接收方。该阶段分为4步：

　　（a）证书：服务器将数字证书和到根CA整个链发给客户端，使客户端能用服务器证书中的服务器公钥认证服务器。

　　（b）服务器密钥交换（可选）：这里视密钥交换算法而定

　　（c）证书请求：服务端可能会要求客户自身进行验证。

　　（d）服务器握手完成：第二阶段的结束，第三阶段开始的信号

![1579611573461](./css/images/1579611573461.png)



这里重点介绍一下服务端的验证和密钥交换。这个阶段的前面的（a）证书 和（b）服务器密钥交换是基于密钥交换方法的。而在SSL中密钥交换算法有6种：无效（没有密钥交换）、RSA、匿名Diffie-Hellman、暂时Diffie-Hellman、固定Diffie-Hellman、Fortezza。



在阶段1过程客户端与服务端协商的过程中已经确定使哪种密钥交换算法。

如果协商过程中确定使用RSA交换密钥，那么过程如下图：

![1579611744777](./css//images/1579611744777.png)

这个方法中，服务器在它的第一个信息中，发送了RSA加密/解密公钥证书。不过，因为预备主秘密是由客户端在下一个阶段生成并发送的，所以第二个信息是空的。注意，公钥证书会进行从服务器到客户端的验证。当服务器收到预备主秘密时，它使用私钥进行解密。服务端拥有私钥是一个证据，可以证明服务器是一个它在第一个信息发送的公钥证书中要求的实体。



### **客户机鉴别与密钥交换**

![1579611785346](./css/images/1579611785346.png)

客户机启动SSL握手第3阶段，是本阶段所有消息的唯一发送方，服务器是所有消息的唯一接收方。该阶段分为3步：

　　（a）证书（可选）：为了对服务器证明自身，客户要发送一个证书信息，这是可选的，在IIS中可以配置强制客户端证书认证。

　　（b）客户机密钥交换（Pre-master-secret）：这里客户端将预备主密钥发送给服务端，注意这里会使用服务端的公钥进行加密。

　　（c）证书验证（可选），对预备秘密和随机数进行签名，证明拥有（a）证书的公钥。



下面也重点介绍一下RSA方式的客户端验证和密钥交换。

![1579611819656](./css//images/1579611819656.png)

这种情况，除非服务器在阶段II明确请求，否则没有证书信息。客户端密钥交换方法包括阶段II收到的由RSA公钥加密的预备主密钥。

阶段III之后，客户要有服务器进行验证，客户和服务器都知道预备主密钥。



### 完成

![1579611872369](./css//images/1579611872369.png)

客户机启动SSL握手第4阶段，使服务器结束。该阶段分为4步，前2个消息来自客户机，后2个消息来自服务器。



## **密钥生成的过程**

为了保证信息的完整性和机密性，SSL需要有六个加密秘密：四个密钥和两个IV。为了信息的可信性，客户端需要一个密钥（HMAC），为了加密要有一个密钥，为了分组加密要一个IV，服务也是如此。SSL需要的密钥是单向的，不同于那些在其他方向的密钥。如果在一个方向上有攻击，这种攻击在其他方向是没影响的。生成过程如下：

![1579611938266](./css/images/1579611938266.png)

![1579611951740](./css/images/1579611951740.png)

![1579611969541](./css/images/1579611969541.png)

## **记录协议** 

　记录协议在客户机和服务器握手成功后使用，即客户机和服务器鉴别对方和确定安全信息交换使用的算法后，进入SSL记录协议，记录协议向SSL连接提供两个服务：

　　（1）保密性：使用握手协议定义的秘密密钥实现

　　（2）完整性：握手协议定义了MAC，用于保证消息完整性

　记录协议的过程：

![1579612025937](./css/images/1579612025937.png)



## 警报协议

客户机和服务器发现错误时，向对方发送一个警报消息。如果是致命错误，则算法立即关闭SSL连接，双方还会先删除相关的会话号，秘密和密钥。每个警报消息共2个字节，第1个字节表示错误类型，如果是警报，则值为1，如果是致命错误，则值为2；第2个字节制定实际错误类型。



## ssl的过程

+ 在ssl中会使用密钥交换算法来交换密钥
+ 使用密钥对数据进行加密
+ 使用散列算法对数据的完整性进行验证
+ 使用数字证书证明自己的身份



## 最后

详细内容，需要阅读《密码学与网络安全》